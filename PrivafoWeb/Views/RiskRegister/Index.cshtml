@{
    ViewData["Title"] = "Module";
}

@section CssSection
{
    <style type="text/css">
        .wrap{
            margin:0 auto;
            margin-top:20px;
            width:560px;
        }
        .square{ 
            border: 1px solid white;
            float:left;
            background: #99ccff;
            color:white;
            text-align:center;
            display:flex;
            justify-content:center;
            align-items:center;
        }
        .square:hover{ 
            opacity:0.5;
            cursor:pointer;
        }
    </style>
}   

@section rtpage
{
    <div class="ms-auto">
	    <a asp-controller="RiskRegister" asp-action="Upsert" class="btn btn-primary radius-30 mt-2 mt-lg-0" ><i class="bx bxs-plus-square"></i>Add Risk Register</a>
    </div>
}

<div id="view-all">
    <div class="card">
        <div class="card-body">
            <div class="wrap">
            </div>
            <div class="form-group">
                <input type="color" id="color"  />
            </div>
        </div>
    </div>
    <div class="card">
		<div class="card-body">
            <div class="d-lg-flex align-items-center mb-4 gap-3">
				<div class="position-relative">
					<input type="text" class="form-control ps-5 radius-30" placeholder="Search Order"> <span class="position-absolute top-50 product-show translate-middle-y"><i class="bx bx-search"></i></span>
				</div>
			</div>
	        <div class="table-responsive">
                <table id="tblData" class="table" style="width:100%">
                    <thead class="table-light">
                        <tr>
                            <th>Risk Name</th>
                            <th>Description</th>
                            <th>Organization</th>
                            <th>Type</th>
                            <th>Residual Risk Level</th>
                            <th>Inherent Risk Level</th>
                            <th>Source</th>
                            <th>Risk Owner</th>
                            <th>Stage</th>
                            <th>Treatment Status</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    
</div>

@section Scripts{
    <script src="~/js/datagrid/riskregister.js"> </script>
    <script type="text/javascript">
        $(document).ready(function() {

          function newGrid(nImpact, nProb) {
            $(".square").remove();

            $.ajax({
                type: 'GET',
                url: "/RiskMatrix/GetAll",
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                success: OnSuccess,  
                failure: function (res) {
                    alert(res.d);
                },
                error: function (res) {
                    alert(res.d);
                }
            })
          };

          function OnSuccess(res) {
            alert(res.riskMxScore);

            nImpact = res.totalImpact;
            nProb = res.totalProb;
            var n=0;
            for (var k = 0; k < nImpact; k++) {
                for (var i = 0; i < nProb; i++) {
                    var mxid = res.riskMxScore[n].id;
                    var boxid = "scr_" + MxId;
                    var val = res.riskMxScore[n].score;
                    var xcolor = res.riskMxScore[n].lvlScoreColor;
                    var levelname = res.riskMxScore[n].lvlScoreName;

                    $(".wrap").append($("<div>" + val + "</div>").attr('id', boxid).height(30).width(50));     
                    $("#" + boxid).addClass("square");     
                    $("#" + boxid).css("background", xcolor);    
                    $("#" + boxid).attr("MxID", mxid);    
                    $("#" + boxid).attr("MxLevel", levelname);    

                    $("#" + boxid).click(function(){
                        var mxid = $(this).attr('MxID');
                        var score = $(this).html();
                        alert(score);
                    });
                    
                    n++;
                }
                $(".wrap").append($("<div></div>").css("clear", "both"));
            }
          };

          function scorehover() {
            $(".square").hover(function() {
              $(this).css("background", "white");
            });
          };

          function clear() {
            $(".square").css("background", "#99ccff");
            $(".square").css("opacity", "1");
          };
  
          function randCol(){
            var R = Math.floor(Math.random()*256)
            var G = Math.floor(Math.random()*256)
            var B = Math.floor(Math.random()*256) 
            return "rgb(" + R + "," + G + "," + B + ")";
          };
  
          // start game
          newGrid(16);

          // choose grid dim
          $(".Grid").click(function(){
            newGrid(3, 4);
            clear/*();*/
          });
        });
    </script>
}

